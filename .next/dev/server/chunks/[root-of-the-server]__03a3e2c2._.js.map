{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/baechan/project/test/link-sns/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n    prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/baechan/project/test/link-sns/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\"\nimport GoogleProvider from \"next-auth/providers/google\"\nimport CredentialsProvider from \"next-auth/providers/credentials\"\nimport { PrismaAdapter } from \"@next-auth/prisma-adapter\"\nimport { prisma } from \"@/lib/prisma\"\nimport bcrypt from \"bcryptjs\"\n\nexport const authOptions: NextAuthOptions = {\n    adapter: PrismaAdapter(prisma),\n    providers: [\n        GoogleProvider({\n            clientId: process.env.GOOGLE_CLIENT_ID || \"\",\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\n        }),\n        CredentialsProvider({\n            name: \"Credentials\",\n            credentials: {\n                email: { label: \"Email\", type: \"email\" },\n                password: { label: \"Password\", type: \"password\" }\n            },\n            async authorize(credentials) {\n                if (!credentials?.email || !credentials?.password) {\n                    return null\n                }\n\n                const user = await prisma.user.findUnique({\n                    where: {\n                        email: credentials.email\n                    }\n                })\n\n                if (!user || !user.password) {\n                    return null\n                }\n\n                const isPasswordValid = await bcrypt.compare(\n                    credentials.password,\n                    user.password\n                )\n\n                if (!isPasswordValid) {\n                    return null\n                }\n\n                return {\n                    id: user.id,\n                    email: user.email,\n                    name: user.name,\n                    image: user.image,\n                }\n            }\n        })\n    ],\n    session: {\n        strategy: \"jwt\"\n    },\n    pages: {\n        signIn: \"/login\",\n    },\n    callbacks: {\n        async session({ session, token }) {\n            if (token && session.user) {\n                session.user.id = token.sub as string\n            }\n            return session\n        }\n    }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AACA;;;;;;AAEO,MAAM,cAA+B;IACxC,SAAS,IAAA,uLAAa,EAAC,yHAAM;IAC7B,WAAW;QACP,IAAA,gKAAc,EAAC;YACX,UAAU,QAAQ,GAAG,CAAC,gBAAgB,IAAI;YAC1C,cAAc,QAAQ,GAAG,CAAC,oBAAoB,IAAI;QACtD;QACA,IAAA,qKAAmB,EAAC;YAChB,MAAM;YACN,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YACA,MAAM,WAAU,WAAW;gBACvB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBAC/C,OAAO;gBACX;gBAEA,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACtC,OAAO;wBACH,OAAO,YAAY,KAAK;oBAC5B;gBACJ;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;oBACzB,OAAO;gBACX;gBAEA,MAAM,kBAAkB,MAAM,8IAAM,CAAC,OAAO,CACxC,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGjB,IAAI,CAAC,iBAAiB;oBAClB,OAAO;gBACX;gBAEA,OAAO;oBACH,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;gBACrB;YACJ;QACJ;KACH;IACD,SAAS;QACL,UAAU;IACd;IACA,OAAO;QACH,QAAQ;IACZ;IACA,WAAW;QACP,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,SAAS,QAAQ,IAAI,EAAE;gBACvB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,GAAG;YAC/B;YACA,OAAO;QACX;IACJ;AACJ"}},
    {"offset": {"line": 346, "column": 0}, "map": {"version":3,"sources":["file:///Users/baechan/project/test/link-sns/app/api/posts/%5Bid%5D/analyze/route.ts"],"sourcesContent":["import { getServerSession } from \"next-auth\"\nimport { authOptions } from \"@/lib/auth\"\nimport { prisma } from \"@/lib/prisma\"\nimport { NextResponse } from \"next/server\"\nimport * as cheerio from \"cheerio\"\n\nexport async function POST(\n    req: Request,\n    { params }: { params: Promise<{ id: string }> }\n) {\n    const session = await getServerSession(authOptions)\n    const { id } = await params\n\n    if (!session) {\n        return new NextResponse(\"Unauthorized\", { status: 401 })\n    }\n\n    try {\n        const post = await prisma.post.findUnique({\n            where: { id }\n        })\n\n        if (!post) {\n            return new NextResponse(\"Post not found\", { status: 404 })\n        }\n\n        const url = post.url\n        let aiSummary = \"\"\n        let tags: string[] = []\n\n        // Fetch page content for AI analysis\n        try {\n            const response = await fetch(url)\n            const html = await response.text()\n            const $ = cheerio.load(html)\n\n            // Extract text content from HTML\n            const textContent = $('body').text().replace(/\\s+/g, ' ').trim().slice(0, 5000)\n\n            // Re-use existing title/desc if needed, or just use what's in DB\n            const title = post.title\n            const description = post.description || \"\"\n\n            const apiKey = process.env.GEMINI_API_KEY\n\n            // Only attempt AI generation if API key is configured and valid\n            if (apiKey && apiKey !== 'your-api-key-here') {\n                const { GoogleGenerativeAI } = await import('@google/generative-ai')\n                const genAI = new GoogleGenerativeAI(apiKey)\n\n                // Try multiple models in order of preference\n                const modelsToTry = ['gemini-2.5-flash', 'gemini-2.0-flash', 'gemini-2.0-flash-lite']\n\n                for (const modelName of modelsToTry) {\n                    try {\n                        const model = genAI.getGenerativeModel({ model: modelName })\n\n                        const prompt = `다음 웹페이지를 분석해주세요:\n\n제목: ${title}\n설명: ${description}\n내용: ${textContent}\n\n다음 형식으로 응답해주세요:\nSUMMARY: [3-4문장으로 핵심 내용 요약]\nTAGS: [관련 키워드 3-5개를 쉼표로 구분, 예: React,TypeScript,웹개발]`\n\n                        const result = await model.generateContent(prompt)\n                        const response = result.response.text()\n\n                        // Parse response\n                        const summaryMatch = response.match(/SUMMARY:\\s*([\\s\\S]+?)(?=TAGS:|$)/)\n                        const tagsMatch = response.match(/TAGS:\\s*([\\s\\S]+?)$/)\n\n                        if (summaryMatch) {\n                            aiSummary = summaryMatch[1].trim()\n                        }\n                        if (tagsMatch) {\n                            const aiTags = tagsMatch[1].trim().split(',').map(t => t.trim())\n                            // Merge with existing tags, avoiding duplicates\n                            const existingTags = post.tags ? post.tags.split(',') : []\n                            const newTags = [...new Set([...existingTags, ...aiTags])]\n                            tags = newTags\n                        }\n\n                        console.log(`AI content generated successfully using ${modelName}`)\n                        break\n                    } catch (modelError: any) {\n                        console.log(`Failed with ${modelName}, trying next model...`)\n                        if (modelName === modelsToTry[modelsToTry.length - 1]) {\n                            throw modelError\n                        }\n                    }\n                }\n            }\n        } catch (error) {\n            console.error(\"Error in AI analysis:\", error)\n            return new NextResponse(\"Analysis Failed\", { status: 500 })\n        }\n\n        // Update post with AI results\n        if (aiSummary || tags.length > 0) {\n            await prisma.post.update({\n                where: { id },\n                data: {\n                    aiSummary: aiSummary || undefined,\n                    tags: tags.length > 0 ? tags.join(',') : undefined\n                }\n            })\n        }\n\n        return NextResponse.json({ success: true })\n    } catch (error) {\n        console.error(\"Error analyzing post:\", error)\n        return new NextResponse(\"Internal Error\", { status: 500 })\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AAAA;;;;;;AAEO,eAAe,KAClB,GAAY,EACZ,EAAE,MAAM,EAAuC;IAE/C,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,4HAAW;IAClD,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IAErB,IAAI,CAAC,SAAS;QACV,OAAO,IAAI,gJAAY,CAAC,gBAAgB;YAAE,QAAQ;QAAI;IAC1D;IAEA,IAAI;QACA,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE;YAAG;QAChB;QAEA,IAAI,CAAC,MAAM;YACP,OAAO,IAAI,gJAAY,CAAC,kBAAkB;gBAAE,QAAQ;YAAI;QAC5D;QAEA,MAAM,MAAM,KAAK,GAAG;QACpB,IAAI,YAAY;QAChB,IAAI,OAAiB,EAAE;QAEvB,qCAAqC;QACrC,IAAI;YACA,MAAM,WAAW,MAAM,MAAM;YAC7B,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,MAAM,IAAI,iKAAY,CAAC;YAEvB,iCAAiC;YACjC,MAAM,cAAc,EAAE,QAAQ,IAAI,GAAG,OAAO,CAAC,QAAQ,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG;YAE1E,iEAAiE;YACjE,MAAM,QAAQ,KAAK,KAAK;YACxB,MAAM,cAAc,KAAK,WAAW,IAAI;YAExC,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;YAEzC,gEAAgE;YAChE,IAAI,UAAU,WAAW,qBAAqB;gBAC1C,MAAM,EAAE,kBAAkB,EAAE,GAAG;gBAC/B,MAAM,QAAQ,IAAI,mBAAmB;gBAErC,6CAA6C;gBAC7C,MAAM,cAAc;oBAAC;oBAAoB;oBAAoB;iBAAwB;gBAErF,KAAK,MAAM,aAAa,YAAa;oBACjC,IAAI;wBACA,MAAM,QAAQ,MAAM,kBAAkB,CAAC;4BAAE,OAAO;wBAAU;wBAE1D,MAAM,SAAS,CAAC;;IAEpC,EAAE,MAAM;IACR,EAAE,YAAY;IACd,EAAE,YAAY;;;;oDAIkC,CAAC;wBAE7B,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;wBAC3C,MAAM,WAAW,OAAO,QAAQ,CAAC,IAAI;wBAErC,iBAAiB;wBACjB,MAAM,eAAe,SAAS,KAAK,CAAC;wBACpC,MAAM,YAAY,SAAS,KAAK,CAAC;wBAEjC,IAAI,cAAc;4BACd,YAAY,YAAY,CAAC,EAAE,CAAC,IAAI;wBACpC;wBACA,IAAI,WAAW;4BACX,MAAM,SAAS,SAAS,CAAC,EAAE,CAAC,IAAI,GAAG,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI;4BAC7D,gDAAgD;4BAChD,MAAM,eAAe,KAAK,IAAI,GAAG,KAAK,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE;4BAC1D,MAAM,UAAU;mCAAI,IAAI,IAAI;uCAAI;uCAAiB;iCAAO;6BAAE;4BAC1D,OAAO;wBACX;wBAEA,QAAQ,GAAG,CAAC,CAAC,wCAAwC,EAAE,WAAW;wBAClE;oBACJ,EAAE,OAAO,YAAiB;wBACtB,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,UAAU,sBAAsB,CAAC;wBAC5D,IAAI,cAAc,WAAW,CAAC,YAAY,MAAM,GAAG,EAAE,EAAE;4BACnD,MAAM;wBACV;oBACJ;gBACJ;YACJ;QACJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,yBAAyB;YACvC,OAAO,IAAI,gJAAY,CAAC,mBAAmB;gBAAE,QAAQ;YAAI;QAC7D;QAEA,8BAA8B;QAC9B,IAAI,aAAa,KAAK,MAAM,GAAG,GAAG;YAC9B,MAAM,yHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBACrB,OAAO;oBAAE;gBAAG;gBACZ,MAAM;oBACF,WAAW,aAAa;oBACxB,MAAM,KAAK,MAAM,GAAG,IAAI,KAAK,IAAI,CAAC,OAAO;gBAC7C;YACJ;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,IAAI,gJAAY,CAAC,kBAAkB;YAAE,QAAQ;QAAI;IAC5D;AACJ"}}]
}